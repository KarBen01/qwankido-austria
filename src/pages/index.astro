---
import Layout from '../layouts/Layout.astro';
import Highlights from '../components/Highlights.jsx';
import EventCard from '../components/EventCard.jsx';
import TrainingChangeCard from '../components/TrainingChangeCard.jsx';
import PDFCard from '../components/PDFCard.jsx';
import {
    EVENTS,
    TRAINING_CHANGES,
    getValidHighlights,
    getUpcomingEvents,
    getUpcomingTrainingChanges
} from '../data/siteData.js';

// PDF paths from public folder
const aufnahmeformularPdf = '/documents/QKDATAufnahmeformular.pdf';
const trainingsordnungPdf = '/documents/QKDATRahmenbedingungenTrainingsordnung.pdf';
const datenschutzPdf = '/documents/QKDATDatenschutzbestimmung.pdf';
const einwilligungPdf = '/documents/QKDATEinwilligung-Fotos-und-Notfallkontakt.pdf';
import {
    ArrowRight,
    MapPin,
    Calendar,
    Download,
    FileText,
    Info,
    Facebook,
    ExternalLink,
    ChevronRight,
    Shield,
    Camera,
    Phone,
    PenTool,
    Scale,
    AlertCircle,
    Mail
} from 'lucide-react';

// --- PERFORMANCE UPDATE: Astro Assets ---
import {Image} from 'astro:assets';
import heroBg from '../assets/hero-bg.jpg';

const BASE_URL = import.meta.env.BASE_URL;
// WICHTIG: Du musst ein Bild namens 'hero-bg.jpg' in 'src/assets/' ablegen!

// Process highlights to add BASE_URL to PDF links
const validHighlights = getValidHighlights().map(highlight => ({
    ...highlight,
    link: highlight.link ? `${BASE_URL}${highlight.link}` : highlight.link
}));

// Helper f√ºr Monatsnamen
const getMonthName = (monthStr) => {
    const months = {
        "01": "JAN", "02": "FEB", "03": "M√ÑR", "04": "APR", "05": "MAI", "06": "JUN",
        "07": "JUL", "08": "AUG", "09": "SEP", "10": "OKT", "11": "NOV", "12": "DEZ"
    };
    return months[monthStr] || monthStr;
};
---

<Layout title="Home">
    <!-- HERO SECTION -->
    <section
            class="relative min-h-[500px] sm:min-h-[600px] md:h-[650px] flex items-center justify-center text-center px-4 overflow-hidden bg-slate-900">
        <div class="absolute inset-0 z-0">
            <Image
                    src={heroBg}
                    alt="Qwan Ki Do Training Gruppe"
                    class="w-full h-full object-cover object-top opacity-50"
                    width={1920}
                    loading="eager"
                    fetchpriority="high"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-slate-950 via-slate-900/60 to-slate-900/30"></div>
        </div>

        <div class="relative z-10 max-w-4xl mx-auto mt-16 animate-fade-in-up">

            <h1 class="text-4xl sm:text-5xl md:text-7xl font-black text-white mb-6 tracking-tight drop-shadow-2xl">
                QWAN KI DO <br/> <span class="text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-red-600">√ñSTERREICH</span>
            </h1>

            <p class="text-base sm:text-lg md:text-2xl text-slate-200 font-bold tracking-widest mb-10 max-w-2xl mx-auto leading-relaxed drop-shadow-md uppercase">
                Sino-Vietnamesisches Kung Fu
            </p>

            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href={`${BASE_URL}/vereine`}
                   class="w-full sm:w-auto bg-red-600 text-white px-8 py-4 rounded-xl font-bold hover:bg-red-700 hover:scale-105 transition-all duration-300 shadow-xl shadow-red-900/40 flex items-center justify-center gap-2">
                    Verein finden
                </a>
                <a href="#infos"
                   class="w-full sm:w-auto bg-white/10 backdrop-blur-md text-white border border-white/20 px-8 py-4 rounded-xl font-bold hover:bg-white hover:text-slate-900 transition-all duration-300 shadow flex items-center justify-center">
                    Mehr erfahren
                </a>
            </div>
        </div>
    </section>

    <!-- SECTION 1: DASHBOARD (Highlights & Termine) -->
    <section class="py-16 px-4 bg-slate-50 relative z-10 border-t border-slate-200">
        <div class="max-w-6xl mx-auto -mt-24">

            <!-- Highlights (Important Announcements) -->
            <div class="mb-12">
                <Highlights highlights={validHighlights} client:load/>
            </div>

            <!-- Kommende Termine (Events) -->
            <div class="mb-12">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-slate-900 flex items-center gap-2">
                        <Calendar className="text-red-600"/>
                        Kommende Termine
                    </h2>
                    <a href={`${BASE_URL}/aktuelles`}
                       class="text-sm font-bold text-slate-500 hover:text-red-600 transition flex items-center gap-1">
                        Alle ansehen
                        <ArrowRight size={16}/>
                    </a>
                </div>

                <div class="grid gap-4">
                    {getUpcomingEvents().slice(0, 5).map((event) => (
                        <EventCard event={event} client:load/>
                    ))}
                </div>
            </div>

            <!-- Training Changes (if any upcoming) -->
            {getUpcomingTrainingChanges().length > 0 && (
                <div class="mb-12">
                    <h2 class="text-2xl font-bold text-slate-900 flex items-center gap-2 mb-6">
                        <AlertCircle className="text-amber-600"/>
                        Training √Ñnderungen
                    </h2>
                    <div class="grid gap-4">
                        {getUpcomingTrainingChanges().slice(0, 3).map((change) => (
                            <TrainingChangeCard change={change} client:load/>
                        ))}
                    </div>
                </div>
            )}

        </div>
    </section>

    <!-- SECTION 2: SOCIAL / FACEBOOK FEED -->
    <section class="py-20 px-4 bg-white border-t border-slate-100">
        <div class="max-w-6xl mx-auto">
            <div class="text-center mb-12">
                <div class="inline-flex items-center justify-center p-3 bg-red-50 rounded-2xl mb-4">
                    <Facebook size={28} className="text-red-600"/>
                </div>
                <span class="text-red-600 font-bold tracking-wider uppercase text-sm mb-2 block">Community</span>
                <h2 class="text-3xl md:text-4xl font-black text-slate-900 mb-4">Neues aus den Vereinen</h2>
                <p class="text-slate-600 max-w-2xl mx-auto mb-6">
                    Bleib auf dem Laufenden mit den neuesten Nachrichten, Erfolgen und Events direkt von unserer
                    Facebook-Seite.
                </p>
                <a href="https://facebook.com/qwankidoaustria" target="_blank"
                   class="inline-flex items-center gap-2 px-6 py-3 rounded-xl font-bold text-white bg-[#1877F2] hover:bg-[#166fe5] hover:scale-105 transition-all duration-300 shadow-lg shadow-blue-900/20">
                    <Facebook size={20}/>
                    Folge uns auf Facebook
                </a>
            </div>

            <!-- Facebook Page Plugin Container - Centered & Responsive -->
            <div class="w-full sm:w-[500px] sm:mx-auto">
                <div class="fb-page"
                     data-href="https://www.facebook.com/qwankidoaustria"
                     data-tabs="timeline"
                     data-width="500"
                     data-height="700"
                     data-small-header="false"
                     data-adapt-container-width="true"
                     data-hide-cover="false"
                     data-show-facepile="false">
                    <blockquote cite="https://www.facebook.com/qwankidoaustria" class="fb-xfbml-parse-ignore">
                        <a href="https://www.facebook.com/qwankidoaustria"
                           class="text-red-600 hover:underline font-semibold">
                            Qwan Ki Do Austria auf Facebook
                        </a>
                    </blockquote>
                </div>
            </div>

            <!-- Mobile Optimization Note -->
            <div class="mt-6 text-center">
                <p class="text-xs text-slate-500">
                    üí° Auf mobilen Ger√§ten nach unten scrollen f√ºr mehr Beitr√§ge
                </p>
            </div>
        </div>
    </section>

    <!-- NEWSLETTER SECTION (Mailjet Integrated) -->
    <section class="py-20 px-4 bg-slate-900 text-white relative overflow-hidden">
        <div class="absolute inset-0 opacity-5 bg-[radial-gradient(#fff_1px,transparent_1px)] [background-size:20px_20px]"></div>

        <div class="max-w-4xl mx-auto text-center relative z-10">
            <div class="inline-flex items-center justify-center p-3 bg-slate-800 rounded-2xl mb-6 shadow-sm border border-slate-700">
                <Mail size={32} class="text-red-500"/>
            </div>
            <h2 class="text-3xl md:text-4xl font-bold mb-4">Bleib auf dem Laufenden</h2>
            <p class="text-slate-400 mb-8 text-lg max-w-xl mx-auto">
                Verpasse keine Termine mehr! Erhalte monatlich alle Infos zu Pr√ºfungen, Seminaren und Events direkt in
                dein Postfach.
            </p>

            <!-- Mailjet Widget Container -->
            <div class="bg-white rounded-xl shadow-2xl p-2 max-w-xl mx-auto overflow-hidden">
                <div class="overflow-hidden">
                    <iframe
                            data-w-type="embedded"
                            frameborder="0"
                            scrolling="no"
                            marginheight="5px"
                            marginwidth="2px"
                            src="https://9q3r.mjt.lu/wgt/9q3r/q45/form?c=439ae1c9"
                            width="100%"
                    ></iframe>
                    <script type="text/javascript" src="https://app.mailjet.com/pas-nc-embedded-v1.js"></script>
                </div>
            </div>
            <p class="text-xs text-slate-500 mt-4">Kein Spam, jederzeit abbestellbar.</p>
        </div>
    </section>

    <!-- DOWNLOADS & INFOS (Main Section) -->
    <section id="infos" class="py-20 px-4 bg-slate-50 border-t border-slate-200">
        <div class="max-w-5xl mx-auto">
            <div class="text-center max-w-3xl mx-auto mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-6">Infos zur Anmeldung</h2>
                <div class="prose prose-slate mx-auto text-slate-600 leading-relaxed mb-8">
                    <p>
                        Sie finden hier unsere Trainingsordnung, Datenschutzbestimmung, und Einwilligung zu Medien, die
                        f√ºr ein Trainieren in unseren Vereinen zur Kenntnis genommen werden m√ºssen. Die Angabe eines
                        Notfallkontaktes ist wichtig, besonders bei j√ºngeren Trainierenden, falls sich zB bez√ºglich
                        Abholzeiten etwas √§ndern sollte etc. Zus√§tzlich finden Sie unser Anmeldeformular ebenfalls zum
                        Downloaden zur Verf√ºgung.
                    </p>
                </div>

                <!-- Wichtiger Hinweis √ºber die ganze Breite -->
                <div class="bg-white border border-red-200 p-5 rounded-2xl shadow-sm inline-block">
                    <p class="text-slate-800 font-medium flex flex-col sm:flex-row items-center justify-center gap-3 text-sm sm:text-base">
                        <AlertCircle size={24} className="text-red-600 shrink-0"/>
                        <span>Bitte Formulare ausgedruckt zum Training mitbringen. Sie k√∂nnen uns die Formulare gerne auch eingescannt oder digital bearbeitet zukommen lassen.</span>
                    </p>
                </div>
            </div>

            <!-- Download Grid (Consistent Icons, Light Theme) -->
            <div class="grid sm:grid-cols-2 md:grid-cols-3 gap-4">
                <PDFCard
                        href={`${BASE_URL}${aufnahmeformularPdf}`}
                        iconName="PenTool"
                        title="Aufnahmeformular"
                        subtitle="PDF Download"
                        client:only="react"
                />

                <PDFCard
                        href={`${BASE_URL}${trainingsordnungPdf}`}
                        iconName="Scale"
                        title="Trainingsordnung"
                        subtitle="PDF Download"
                        client:only="react"
                />

                <PDFCard
                        href={`${BASE_URL}${datenschutzPdf}`}
                        iconName="Shield"
                        title="Datenschutz"
                        subtitle="PDF Download"
                        client:only="react"
                />

                <PDFCard
                        href={`${BASE_URL}${einwilligungPdf}`}
                        iconName="Camera"
                        title="Einwilligung Fotos & Notfallkontakt"
                        subtitle="PDF Download ‚Ä¢ Wichtig f√ºr Kinder & Medienfreigabe"
                        colSpan="sm:col-span-2 md:col-span-3"
                        client:only="react"
                />

                <!-- Placeholder for missing PDF -->
                <PDFCard
                        href="#"
                        iconName="FileText"
                        title="Weiteres Dokument"
                        subtitle="Folgt in K√ºrze"
                        colSpan="sm:col-span-2 md:col-span-3"
                        client:only="react"
                />
            </div>
        </div>
    </section>
</Layout>